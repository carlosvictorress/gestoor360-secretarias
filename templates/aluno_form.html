{% extends 'base.html' %}

{% block title %}Editar Aluno{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-person-fill-gear"></i> Editar Dados do Aluno</h2>
    <a href="{{ url_for('transporte.detalhes_rota', rota_id=aluno.rota_id) }}" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Voltar para a Rota</a>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <form method="POST">
            <h5 class="mb-3 text-muted">Dados Pessoais</h5>
            <div class="row g-3">
                <div class="col-md-6"><label class="form-label">Nome Completo*</label><input type="text" class="form-control" name="nome_completo" value="{{ aluno.nome_completo }}" required></div>
                <div class="col-md-3"><label class="form-label">Data de Nascimento*</label><input type="date" class="form-control" name="data_nascimento" value="{{ aluno.data_nascimento.strftime('%Y-%m-%d') if aluno.data_nascimento }}" required></div>
                <div class="col-md-3"><label class="form-label">Ano/Série que Estuda*</label><input type="text" class="form-control" name="ano_estudo" value="{{ aluno.ano_estudo }}" required></div>
            </div>
            
            <hr class="my-4">
            <h5 class="mb-3 text-muted">Dados Escolares e Contato</h5>
            <div class="row g-3">
                <div class="col-md-5"><label class="form-label">Escola em que Estuda*</label><input type="text" class="form-control" name="escola" value="{{ aluno.escola }}" required></div>
                <div class="col-md-2"><label class="form-label">Turno*</label><select name="turno" class="form-select" required><option value="Manhã" {% if aluno.turno == 'Manhã' %}selected{% endif %}>Manhã</option><option value="Tarde" {% if aluno.turno == 'Tarde' %}selected{% endif %}>Tarde</option></select></div>
                <div class="col-md-2"><label class="form-label">Localização*</label><select name="zona" class="form-select" required><option value="Urbana" {% if aluno.zona == 'Urbana' %}selected{% endif %}>Urbana</option><option value="Rural" {% if aluno.zona == 'Rural' %}selected{% endif %}>Rural</option></select></div>
                <div class="col-md-3"><label class="form-label">Telefone do Responsável*</label><input type="text" class="form-control" name="telefone_responsavel" value="{{ aluno.telefone_responsavel }}" required></div>
            </div>
            <div class="row g-3 mt-2">
                <div class="col-md-6"><label class="form-label">Nome do Responsável*</label><input type="text" class="form-control" name="nome_responsavel" value="{{ aluno.nome_responsavel }}" required></div>
                <div class="col-md-6"><label class="form-label">Endereço do Aluno*</label><input type="text" class="form-control" name="endereco_aluno" value="{{ aluno.endereco_aluno }}" required></div>
            </div>

            <hr class="my-4">
            <h5 class="mb-3 text-muted">Informações Adicionais (Censo Escolar)</h5>
            <div class="row g-3">
                <div class="col-md-4"><label class="form-label">Sexo</label><select name="sexo" class="form-select"><option value="" {% if not aluno.sexo %}selected{% endif %}>Não declarado</option><option value="Masculino" {% if aluno.sexo == 'Masculino' %}selected{% endif %}>Masculino</option><option value="Feminino" {% if aluno.sexo == 'Feminino' %}selected{% endif %}>Feminino</option></select></div>
                <div class="col-md-4"><label class="form-label">Cor/Raça</label><select name="cor" class="form-select"><option value="" {% if not aluno.cor %}selected{% endif %}>Não declarada</option><option value="Branca" {% if aluno.cor == 'Branca' %}selected{% endif %}>Branca</option><option value="Parda" {% if aluno.cor == 'Parda' %}selected{% endif %}>Parda</option><option value="Preta" {% if aluno.cor == 'Preta' %}selected{% endif %}>Preta</option><option value="Amarela" {% if aluno.cor == 'Amarela' %}selected{% endif %}>Amarela</option><option value="Indígena" {% if aluno.cor == 'Indígena' %}selected{% endif %}>Indígena</option></select></div>
                <div class="col-md-4"><label class="form-label">Nível de Ensino</label><select name="nivel_ensino" class="form-select"><option value="" {% if not aluno.nivel_ensino %}selected{% endif %}>Não informado</option><option value="Infantil (Creche)" {% if aluno.nivel_ensino == 'Infantil (Creche)' %}selected{% endif %}>Infantil (Creche)</option><option value="Infantil (Pré-escola)" {% if aluno.nivel_ensino == 'Infantil (Pré-escola)' %}selected{% endif %}>Infantil (Pré-escola)</option><option value="Fundamental" {% if aluno.nivel_ensino == 'Fundamental' %}selected{% endif %}>Fundamental</option><option value="Medio" {% if aluno.nivel_ensino == 'Medio' %}selected{% endif %}>Médio</option><option value="Superior" {% if aluno.nivel_ensino == 'Superior' %}selected{% endif %}>Superior</option><option value="Outro" {% if aluno.nivel_ensino == 'Outro' %}selected{% endif %}>Outro</option></select></div>
            </div>
            <div class="row g-3 mt-2">
                <div class="col-md-4"><div class="form-check mt-4"><input class="form-check-input" type="checkbox" name="possui_deficiencia" id="checkDeficiencia" {% if aluno.possui_deficiencia %}checked{% endif %}><label class="form-check-label" for="checkDeficiencia">Possui alguma deficiência?</label></div></div>
                <div class="col-md-8" id="campoTipoDeficiencia" style="display: {% if aluno.possui_deficiencia %}block{% else %}none{% endif %};"><label class="form-label">Se sim, qual?</label><input type="text" class="form-control" name="tipo_deficiencia" value="{{ aluno.tipo_deficiencia or '' }}" placeholder="Descreva a deficiência"></div>
            </div>
            
            <div class="mt-4">
                <button type="submit" class="btn btn-primary"><i class="bi bi-save-fill"></i> Salvar Alterações</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkDeficiencia = document.getElementById('checkDeficiencia');
        const campoTipoDeficiencia = document.getElementById('campoTipoDeficiencia');
        checkDeficiencia.addEventListener('change', function() {
            if (this.checked) {
                campoTipoDeficiencia.style.display = 'block';
            } else {
                campoTipoDeficiencia.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}